<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Positive Effect Leadership System - Executive Summary Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #2d3748;
            background: #f7fafc;
            padding: 20px;
        }

        .report-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .report-meta {
            background: rgba(251, 191, 36, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            text-align: left;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
        }

        .meta-label {
            font-size: 0.9rem;
            opacity: 0.8;
            font-weight: 500;
        }

        .meta-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #1e3a8a;
            font-size: 1.8rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #fbbf24;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #4a5568;
            font-size: 1.4rem;
            margin-bottom: 15px;
            margin-top: 25px;
        }

        .executive-summary {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 30px;
            border-radius: 12px;
            border-left: 5px solid #fbbf24;
            margin-bottom: 30px;
        }

        .key-findings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .finding-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border-left: 5px solid;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .finding-card.accept {
            border-left-color: #ec4899;
        }

        .finding-card.create {
            border-left-color: #f472b6;
        }

        .finding-card.teach {
            border-left-color: #3b82f6;
        }

        .finding-card.accountability {
            border-left-color: #fbbf24;
        }

        .finding-card h4 {
            color: #2d3748;
            font-size: 1.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .score-badge {
            background: #f7fafc;
            color: #4a5568;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .score-badge.excellent {
            background: #c6f6d5;
            color: #276749;
        }

        .score-badge.good {
            background: #bee3f8;
            color: #2c5282;
        }

        .score-badge.needs-improvement {
            background: #fed7d7;
            color: #9b2c2c;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-top: 4px solid #fbbf24;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #6b7280;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .progress-timeline {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .timeline-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            position: relative;
        }

        .timeline-item.current {
            border-color: #fbbf24;
            background: linear-gradient(135deg, #fefce8 0%, #fef3c7 100%);
        }

        .timeline-phase {
            color: #1e3a8a;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .timeline-description {
            color: #6b7280;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .recommendations {
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }

        .recommendation-item {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #fbbf24;
        }

        .recommendation-item h5 {
            color: #1e3a8a;
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .recommendation-item p {
            color: #4a5568;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .priority-high {
            border-left-color: #ef4444;
        }

        .priority-medium {
            border-left-color: #f59e0b;
        }

        .priority-low {
            border-left-color: #10b981;
        }

        .organizational-overview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 25px 0;
        }

        .overview-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .chart-placeholder {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            height: 200px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            font-style: italic;
            margin: 15px 0;
        }

        .action-items {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .action-items h3 {
            color: white;
            margin-bottom: 20px;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .action-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .action-card h4 {
            color: #fbbf24;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .action-card ul {
            list-style: none;
            padding-left: 0;
        }

        .action-card li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .action-card li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #fbbf24;
            font-weight: bold;
        }

        .signature-section {
            background: #f8fafc;
            padding: 30px;
            border-top: 3px solid #fbbf24;
            margin-top: 40px;
            text-align: center;
        }

        .signature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-top: 30px;
        }

        .signature-block {
            text-align: center;
        }

        .signature-line {
            border-top: 2px solid #e2e8f0;
            margin: 30px 20px 10px 20px;
        }

        .signature-title {
            color: #6b7280;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .print-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .control-btn {
            background: #1e3a8a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s ease;
        }

        .control-btn:hover {
            background: #1e40af;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .print-controls {
                display: none;
            }
            
            .report-container {
                box-shadow: none;
                border-radius: 0;
            }
            
            .section {
                break-inside: avoid;
            }
        }

        @media (max-width: 768px) {
            .organizational-overview {
                grid-template-columns: 1fr;
            }
            
            .content {
                padding: 20px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .print-controls {
                position: static;
                justify-content: center;
                margin-bottom: 20px;
            }
        }
    </style>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Company Code Authentication Modal -->
    <div id="authModal" style="display: block; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8);">
        <div style="background-color: white; margin: 10% auto; padding: 40px; width: 90%; max-width: 500px; border-radius: 12px; text-align: center;">
            <h2 style="color: #1e3a8a; margin-bottom: 20px;">Executive Dashboard Access</h2>
            <p style="color: #6b7280; margin-bottom: 30px;">Enter your company code to view your team's leadership assessment dashboard.</p>
            <div style="margin-bottom: 20px;">
                <input type="text" id="dashboardCompanyCode" placeholder="Enter Company Code" style="width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px; text-align: center; text-transform: uppercase;">
            </div>
            <button onclick="authenticateCompanyCode()" style="background: #1e3a8a; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%;">
                Access Dashboard
            </button>
            <div id="authError" style="color: #ef4444; margin-top: 15px; font-size: 14px; display: none;"></div>
        </div>
    </div>
    <div class="print-controls">
        <button class="control-btn" onclick="window.print()">📄 Print Report</button>
        <button class="control-btn" onclick="generatePDF()">📊 Export PDF</button>
        <button class="control-btn" onclick="editReport()">✏️ Customize</button>
    </div>

    <div class="report-container">
        <div class="header">
            <h1>The Positive Effect Leadership System</h1>
            <p class="subtitle">Executive Summary Report</p>
            
            <div class="report-meta">
                <div class="meta-item">
                    <span class="meta-label">Organization</span>
                    <span class="meta-value" id="organizationName">[Company Name]</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Assessment Period</span>
                    <span class="meta-value" id="assessmentPeriod">Q1 2024</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Leaders Assessed</span>
                    <span class="meta-value" id="leadersAssessed">24</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Report Date</span>
                    <span class="meta-value" id="reportDate">January 15, 2024</span>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Executive Summary -->
            <div class="section">
                <h2>Executive Summary</h2>
                <div class="executive-summary">
                    <p><strong>The Positive Effect Leadership System Index</strong> provides a comprehensive evaluation of leadership effectiveness across four critical dimensions: Support, Responsible, Selfless, and Accountability. This report summarizes the organizational leadership assessment results and provides strategic recommendations for enhancing positive leadership impact.</p>
                    
                    <p style="margin-top: 15px;"><strong>Key Insight:</strong> Organizations implementing the ACT methodology see an average 34% improvement in employee engagement, 28% increase in team productivity, and 42% reduction in leadership-related turnover within 90 days.</p>
                </div>
            </div>

            <!-- Organizational Metrics -->
            <div class="section">
                <h2>Organizational Leadership Metrics</h2>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="overallScore">73%</div>
                        <div class="metric-label">Overall Leadership Index</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="acceptScore">68%</div>
                        <div class="metric-label">SUPPORT Dimension</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="createScore">75%</div>
                        <div class="metric-label">RESPONSIBLE Dimension</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="teachScore">71%</div>
                        <div class="metric-label">SELFLESS Dimension</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="accountabilityScore">78%</div>
                        <div class="metric-label">ACCOUNTABILITY</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="engagementImprovement">+34%</div>
                        <div class="metric-label">Engagement Improvement</div>
                    </div>
                </div>
            </div>

            <!-- Key Findings by Pillar -->
            <div class="section">
                <h2>Key Findings by Leadership Pillar</h2>
                <div class="key-findings">
                    <div class="finding-card accept">
                        <h4>SUPPORT <span class="score-badge needs-improvement">68% - Needs Focus</span></h4>
                        <p><strong>Strength:</strong> Leaders show good composure under pressure (74% average).</p>
                        <p><strong>Opportunity:</strong> Only 62% consistently face difficult realities and challenging conversations.</p>
                        <p><strong>Impact:</strong> Teams report 23% higher stress levels when leaders avoid difficult conversations.</p>
                    </div>
                    
                    <div class="finding-card create">
                        <h4>RESPONSIBLE <span class="score-badge good">75% - Strong Foundation</span></h4>
                        <p><strong>Strength:</strong> Excellent strategic thinking and vision alignment (81% average).</p>
                        <p><strong>Opportunity:</strong> Mindfulness of others' perspectives could improve (69% average).</p>
                        <p><strong>Impact:</strong> Teams with highly mindful leaders show 31% better collaboration scores.</p>
                    </div>
                    
                    <div class="finding-card teach">
                        <h4>SELFLESS <span class="score-badge good">71% - Developing Well</span></h4>
                        <p><strong>Strength:</strong> Leaders demonstrate openness to learning (76% average).</p>
                        <p><strong>Opportunity:</strong> Coaching and mentoring skills need development (66% average).</p>
                        <p><strong>Impact:</strong> Leaders with strong coaching skills see 45% faster team skill development.</p>
                    </div>
                    
                    <div class="finding-card accountability">
                        <h4>ACCOUNTABILITY <span class="score-badge excellent">78% - Performing Well</span></h4>
                        <p><strong>Strength:</strong> Excellent follow-up systems and tracking (82% average).</p>
                        <p><strong>Opportunity:</strong> Recognition consistency varies across departments (74% average).</p>
                        <p><strong>Impact:</strong> Consistent recognition systems correlate with 38% higher retention.</p>
                    </div>
                </div>
            </div>

            <!-- Organizational Overview -->
            <div class="section">
                <h2>Organizational Leadership Distribution</h2>
                <div class="organizational-overview">
                    <div class="overview-section">
                        <h3>Leadership Levels Performance</h3>
                        <div class="chart-placeholder">
                            [Leadership Distribution Chart]<br>
                            Senior: 81% avg | Middle: 73% avg | Front-line: 67% avg
                        </div>
                        <p>Senior leaders demonstrate stronger positive leadership behaviors, indicating effective role modeling opportunities for development cascade.</p>
                    </div>
                    
                    <div class="overview-section">
                        <h3>Department Comparison</h3>
                        <div class="chart-placeholder">
                            [Department Performance Chart]<br>
                            Sales: 79% | Operations: 72% | Tech: 68% | HR: 76%
                        </div>
                        <p>Sales department leads in positive leadership metrics, while Technology teams show the greatest improvement opportunity.</p>
                    </div>
                </div>
            </div>

            <!-- Progress Timeline -->
            <div class="section">
                <h2>Kirkpatrick Method - Implementation Timeline</h2>
                <div class="progress-timeline">
                    <div class="timeline-item current">
                        <div class="timeline-phase">Level 1: Reaction (Complete)</div>
                        <div class="timeline-description">Assessment completed with 96% participation rate. Leaders report high engagement with the ACT methodology and commitment to development.</div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-phase">Level 2: Learning (30 Days)</div>
                        <div class="timeline-description">Targeted development programs launched. Focus on Accept pillar skills for 60% of leaders, coaching development for 40%.</div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-phase">Level 3: Behavior (90 Days)</div>
                        <div class="timeline-description">Behavior change measurement through 360 feedback, team surveys, and supervisor observations. Target: 25% improvement in lowest-scoring areas.</div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-phase">Level 4: Results (6 Months)</div>
                        <div class="timeline-description">Business impact assessment: employee engagement, retention rates, team productivity, and customer satisfaction metrics.</div>
                    </div>
                </div>
            </div>

            <!-- Strategic Recommendations -->
            <div class="section">
                <h2>Strategic Recommendations</h2>
                <div class="recommendations">
                    <div class="recommendation-item priority-high">
                        <h5>🎯 Priority 1: SUPPORT Dimension Focus (Next 60 Days)</h5>
                        <p>Implement "Supportive Leadership" training program for all leaders. Establish peer coaching partnerships to practice supportive conversation skills. Expected outcome: 20% improvement in SUPPORT scores.</p>
                    </div>
                    
                    <div class="recommendation-item priority-medium">
                        <h5>📈 Priority 2: Selfless Leadership Development (60-120 Days)</h5>
                        <p>Launch internal coaching certification program using SELFLESS pillar methodology. Pair high-performing coaches with developing leaders. Expected outcome: 30% improvement in team development metrics.</p>
                    </div>
                    
                    <div class="recommendation-item priority-medium">
                        <h5>🏆 Priority 3: Recognition System Standardization (90 Days)</h5>
                        <p>Implement organization-wide recognition framework based on top-performing departments. Create digital recognition platform with peer nominations. Expected outcome: 25% increase in recognition consistency.</p>
                    </div>
                    
                    <div class="recommendation-item priority-low">
                        <h5>📚 Priority 4: Continuous Learning Culture (Ongoing)</h5>
                        <p>Establish monthly leadership book clubs, quarterly leadership summits, and mentorship programs. Focus on "The Positive Effect" and "Positive Accountability" methodologies.</p>
                    </div>
                </div>
            </div>

            <!-- Action Items -->
            <div class="action-items">
                <h3>30-60-90 Day Action Plan</h3>
                <div class="action-grid">
                    <div class="action-card">
                        <h4>30 Days - Foundation</h4>
                        <ul>
                            <li>Launch SUPPORT pillar development workshops</li>
                            <li>Establish coaching partnerships</li>
                            <li>Begin weekly check-ins with lowest-scoring leaders</li>
                            <li>Implement digital recognition platform</li>
                            <li>Distribute "Positive Accountability" books</li>
                        </ul>
                    </div>
                    
                    <div class="action-card">
                        <h4>60 Days - Implementation</h4>
                        <ul>
                            <li>Complete first round of coaching skill assessments</li>
                            <li>Launch peer feedback system</li>
                            <li>Conduct mid-point progress reviews</li>
                            <li>Refine recognition processes based on feedback</li>
                            <li>Host first quarterly leadership summit</li>
                        </ul>
                    </div>
                    
                    <div class="action-card">
                        <h4>90 Days - Measurement</h4>
                        <ul>
                            <li>Conduct follow-up assessments (Level 3 Kirkpatrick)</li>
                            <li>Measure team engagement improvements</li>
                            <li>Analyze productivity and retention metrics</li>
                            <li>Celebrate early wins and success stories</li>
                            <li>Plan next phase of development initiatives</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Expected ROI -->
            <div class="section">
                <h2>Expected Return on Investment</h2>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">34%</div>
                        <div class="metric-label">Employee Engagement ↑</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">28%</div>
                        <div class="metric-label">Team Productivity ↑</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">42%</div>
                        <div class="metric-label">Leadership Turnover ↓</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">$2.4M</div>
                        <div class="metric-label">Annual Savings Projected</div>
                    </div>
                </div>
                
                <div class="executive-summary" style="margin-top: 25px;">
                    <p><strong>Investment Summary:</strong> Based on similar organizational implementations, the total investment in The Positive Effect Leadership System typically returns 4:1 ROI within the first year through improved retention, increased productivity, and enhanced employee engagement.</p>
                </div>
            </div>
        </div>

        <!-- Signature Section -->
        <div class="signature-section">
            <h3>Report Prepared By</h3>
            <div class="signature-grid">
                <div class="signature-block">
                    <div class="signature-line"></div>
                    <div class="signature-title">AskApril AI Leadership Development</div>
                </div>
                <div class="signature-block">
                    <div class="signature-line"></div>
                    <div class="signature-title">Executive Sponsor</div>
                </div>
                <div class="signature-block">
                    <div class="signature-line"></div>
                    <div class="signature-title">HR Leadership</div>
                </div>
            </div>
            <p style="margin-top: 30px; color: #6b7280; font-size: 0.9rem;">
                This report is based on The Positive Effect Leadership System Index assessment. 
                For detailed individual reports and development plans, contact AskApril AI at info@askaprilai.com
            </p>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://hjsocguqkvmddlkanyfl.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhqc29jZ3Vxa3ZtZGRsa2FueWZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5ODk2NzEsImV4cCI6MjA3MTU2NTY3MX0.VAluC-nqFz79Z3N3ZBn_tlTg29VlrRHkSqZ3eRc8iQI';
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let companyData = null;
        let teamResults = [];

        // Set current date
        document.getElementById('reportDate').textContent = new Date().toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        // Authenticate company code and load dashboard
        async function authenticateCompanyCode() {
            const code = document.getElementById('dashboardCompanyCode').value.trim().toUpperCase();
            const errorDiv = document.getElementById('authError');
            
            if (!code) {
                showError('Please enter a company code.');
                return;
            }

            try {
                // Check if company code exists and get company info
                const { data: companyInfo, error: companyError } = await supabaseClient
                    .from('company_codes')
                    .select('*')
                    .eq('code', code)
                    .eq('is_active', true)
                    .single();

                if (companyError || !companyInfo) {
                    showError('Invalid company code. Please check and try again.');
                    return;
                }

                // Get anonymous assessment results for this company code
                const { data: results, error: resultsError } = await supabaseClient
                    .from('assessment_results')
                    .select('responses, scores, archetype, framework_scores, completed_at')
                    .eq('company_code_id', companyInfo.id);

                if (resultsError) {
                    console.error('Error fetching results:', resultsError);
                    showError('Error loading dashboard data. Please try again.');
                    return;
                }

                // Store data globally
                companyData = companyInfo;
                teamResults = results || [];

                // Hide auth modal and load dashboard
                document.getElementById('authModal').style.display = 'none';
                
                // Populate dashboard with real data
                loadDashboardData();
                
            } catch (err) {
                console.error('Authentication error:', err);
                showError('Connection error. Please try again.');
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('authError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // Load and display dashboard data
        function loadDashboardData() {
            if (!companyData || !teamResults) return;

            // Update company information
            document.getElementById('organizationName').textContent = companyData.company_name || 'Your Organization';
            document.getElementById('leadersAssessed').textContent = teamResults.length;
            
            // Calculate assessment period
            if (teamResults.length > 0) {
                const dates = teamResults.map(r => new Date(r.completed_at));
                const earliest = new Date(Math.min(...dates));
                const latest = new Date(Math.max(...dates));
                document.getElementById('assessmentPeriod').textContent = 
                    `${earliest.toLocaleDateString()} - ${latest.toLocaleDateString()}`;
            }

            // Calculate anonymous team metrics
            calculateTeamMetrics();
        }

        // Calculate anonymous aggregated team metrics
        function calculateTeamMetrics() {
            if (teamResults.length === 0) {
                // Show no data message
                populateWithNoData();
                return;
            }

            let totalSupport = 0, totalResponsible = 0, totalSelfless = 0, totalAccountability = 0;
            let overallTotal = 0;
            let archetypeCount = {};

            teamResults.forEach(result => {
                if (result.framework_scores) {
                    // Assuming framework_scores structure matches: {support: X, responsible: X, selfless: X, accountability: X}
                    const scores = result.framework_scores;
                    totalSupport += scores.support || scores.accept || 0; // backward compatibility
                    totalResponsible += scores.responsible || scores.create || 0;
                    totalSelfless += scores.selfless || scores.teach || 0;
                    totalAccountability += scores.accountability || 0;
                }

                // Count archetypes anonymously
                if (result.archetype) {
                    archetypeCount[result.archetype] = (archetypeCount[result.archetype] || 0) + 1;
                }
            });

            const teamSize = teamResults.length;
            
            // Calculate averages (convert to percentages)
            const avgSupport = Math.round((totalSupport / teamSize) * 20); // assuming 5-point scale
            const avgResponsible = Math.round((totalResponsible / teamSize) * 20);
            const avgSelfless = Math.round((totalSelfless / teamSize) * 20);
            const avgAccountability = Math.round((totalAccountability / teamSize) * 20);
            const overallAvg = Math.round((avgSupport + avgResponsible + avgSelfless + avgAccountability) / 4);

            // Update dashboard displays
            document.getElementById('overallScore').textContent = `${overallAvg}%`;
            document.getElementById('acceptScore').textContent = `${avgSupport}%`; // Support
            document.getElementById('createScore').textContent = `${avgResponsible}%`; // Responsible
            document.getElementById('teachScore').textContent = `${avgSelfless}%`; // Selfless
            document.getElementById('accountabilityScore').textContent = `${avgAccountability}%`;

            // Calculate improvement estimate based on baseline
            const improvementEstimate = Math.max(15, Math.min(45, 50 - overallAvg));
            document.getElementById('engagementImprovement').textContent = `+${improvementEstimate}%`;

            // Update key findings with real data
            updateKeyFindings(avgSupport, avgResponsible, avgSelfless, avgAccountability);

            // Show most common archetypes (anonymous)
            updateArchetypeDistribution(archetypeCount);
        }

        function updateKeyFindings(support, responsible, selfless, accountability) {
            // Update finding cards with actual team scores
            const findings = [
                { score: support, element: 'accept' },
                { score: responsible, element: 'create' },
                { score: selfless, element: 'teach' },
                { score: accountability, element: 'accountability' }
            ];

            findings.forEach(finding => {
                const card = document.querySelector(`.finding-card.${finding.element}`);
                if (card) {
                    const badge = card.querySelector('.score-badge');
                    let badgeClass = 'needs-improvement';
                    let badgeText = 'Needs Focus';
                    
                    if (finding.score >= 80) {
                        badgeClass = 'excellent';
                        badgeText = 'Excellent';
                    } else if (finding.score >= 70) {
                        badgeClass = 'good';
                        badgeText = 'Strong Foundation';
                    }
                    
                    badge.className = `score-badge ${badgeClass}`;
                    badge.textContent = `${finding.score}% - ${badgeText}`;
                }
            });
        }

        function updateArchetypeDistribution(archetypeCount) {
            // Show anonymous archetype distribution
            const totalCount = Object.values(archetypeCount).reduce((a, b) => a + b, 0);
            let distributionText = 'Team Leadership Archetypes:<br>';
            
            Object.entries(archetypeCount)
                .sort((a, b) => b[1] - a[1])
                .forEach(([archetype, count]) => {
                    const percentage = Math.round((count / totalCount) * 100);
                    distributionText += `${archetype}: ${percentage}% (${count} leaders)<br>`;
                });

            // Update the organizational overview chart placeholder
            const chartPlaceholder = document.querySelector('.chart-placeholder');
            if (chartPlaceholder) {
                chartPlaceholder.innerHTML = distributionText;
            }
        }

        function populateWithNoData() {
            // Show appropriate message when no assessment data is available
            document.getElementById('overallScore').textContent = '0%';
            document.getElementById('acceptScore').textContent = '0%';
            document.getElementById('createScore').textContent = '0%';
            document.getElementById('teachScore').textContent = '0%';
            document.getElementById('accountabilityScore').textContent = '0%';
            document.getElementById('engagementImprovement').textContent = 'N/A';
            
            // Show message in insights
            const insightsSection = document.querySelector('.key-findings');
            if (insightsSection) {
                insightsSection.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;"><h3>No Assessment Data Available</h3><p>Team members haven\'t completed their assessments yet. Once they start using the company code, their anonymous results will appear here.</p></div>';
            }
        }

        function generatePDF() {
            // In a real implementation, this would use a library like jsPDF or html2pdf
            alert('PDF generation would be implemented with jsPDF library for production use.');
        }

        function editReport() {
            const organizationName = prompt('Enter Organization Name:', '[Company Name]');
            const period = prompt('Enter Assessment Period:', 'Q1 2024');
            const leadersCount = prompt('Enter Number of Leaders Assessed:', '24');
            
            if (organizationName) document.getElementById('organizationName').textContent = organizationName;
            if (period) document.getElementById('assessmentPeriod').textContent = period;
            if (leadersCount) document.getElementById('leadersAssessed').textContent = leadersCount;
        }

        // Sample data population function
        function populateWithSampleData() {
            // This would typically be called with real assessment data
            const sampleData = {
                overallScore: 73,
                acceptScore: 68,
                createScore: 75,
                teachScore: 71,
                accountabilityScore: 78,
                engagementImprovement: 34
            };

            Object.keys(sampleData).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (key === 'engagementImprovement') {
                        element.textContent = `+${sampleData[key]}%`;
                    } else {
                        element.textContent = `${sampleData[key]}%`;
                    }
                }
            });
        }

        // Initialize with sample data
        populateWithSampleData();
    </script>
</body>
</html>